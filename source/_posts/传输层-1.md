---
title: 传输层
date: 2021-03-17 23:16:28
tags: 传输层
categories: 计算机网络
---

# 传输层

功能：

- 为应用层提供通信服务，使用网络层的服务
- 提供进程和进程之间的逻辑通信（网络层提供主机之间的逻辑通信）
- 复用和分用
  - 复用：发送方不同的应用进程都可使用同一个传输层协议传输数据
  - 分用：接收方的传输层在剥去报文的首部后能够把数据正确交付到目的应用进程
- 对收到的报文进行差错检测（首部和数据部分）
- 提供两种传输协议
  - TCP
  - UDP

# 传输层的寻址与端口

## 端口

应用层的各种应用进程将其数据通过端口向下交付给传输层，以及让传输层知道应当将其报文段中的数据向上通过端口交付给应用层相应的进程

## 端口号

应用进程通过端口号进行标识，长度为16bit

只具有本地意义

- 服务端使用
  - 熟知端口号（0 ～ 1023）：给TCP/IP最重要的一些应用程序，让所以用户都知道
  - 登记端口号（1024 -～49151）：其他
- 客户端使用（49152 ～ 65535）：仅在客户进程运行时才动态选择

## 套接字

主机IP地址+端口号

唯一的标识网络中的一台主机及其上的一个应用

# UDP

**无连接非可靠的传输层协议**

- 减少开销和发送数据的时延
- 使用最大努力交付，不保证可靠交付
- 面向报文，适合一次性传输少量数据的网络应用
- 一次发一个完整的报文
- 无拥塞控制
- 首部开销小，8B

UDP报头由4个域组成，其中每个域各占用2个字节，具体包括源端口号、目标端口号、数据包长度、校验值。

![preview](https://tva1.sinaimg.cn/large/008eGmZEgy1gon9q4ezmzj30f805pq3u.jpg)

# TCP

**面向连接的传输层协议**

特点

## TCP报文段

![preview](https://tva1.sinaimg.cn/large/008eGmZEgy1gona2wypgtj30dw095jrv.jpg)

## TCP连接管理

使运输连接的建立和释放都能正常进行

### 连接

1. 客户端发送**连接请求报文段**，无应用层数据，SYN=1，seq=x（随机）
2. 服务端为该TCP连接分配缓存和变量，并向客户端返回**确认报文段**，允许连接，无应用层数据，SYN=1，ACK=1，seq=y（随机），ack=x+1
3. 客户端收到确认报文，为该TCP连接分配缓存和变量，并向服务端返回确认的确认，可以携带数据，SYN=0，ACK=1，seq=x+1，ack=y+1

SYN洪范攻击

### 释放

1. 客户端发送**连接释放报文段**，停止发送数据，主动关闭TCP连接
2. 服务端收到连接释放报文段，发出确认，客户端到服务端方向的连接就释放了，TCP处于半关闭状态
3. 服务器发出连接释放报文段
4. 客户端收到连接释放报文段，发出确认，等到时间等待计时器设置的2MSL（最长报文段寿命），连接彻底关闭

## 可靠传输

使用校验、序号、确认和重传等机制

## 流量控制

基于滑动窗口协议的流量控制机制

## 拥塞控制