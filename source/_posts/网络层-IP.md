---
title: 网络层 IP
date: 2021-03-16 22:59:12
tags: 网络层
categories: 计算机网络
---

# TCP/IP协议栈

## IP数据报格式

首部 + 数据部分（TCP、UDP段）

首部：固定部分+可变部分

![](https://tva1.sinaimg.cn/large/e6c9d24egy1gom2n03jtnj20ji092t9k.jpg)

- 版本：IPv4 / IPv6
- 首部长度：单位是4B，最小长度为5
- 区分服务：期望获得哪种类型的服务
- 总长度：首部+数据
- 生存时间TTL：IP分组保质期，经过一个路由器-1，为0则丢弃
- 协议：数据部分的协议（6：TCP，17：UDP）
- 首部检验和：只检验首部
- IP地址
- 可选字段：用来支持排错、测量以及安全等措施
- 填充：全0

## IP数据报分片

MTU：最大传送单元，链路层数据报能承载的最大数据量，以太网的MTU为1500字节

- 标识：同一数据报的分片使用同一标识
- 标志：3位，只有2位有意义，中间位（DF，Don't Fragment)（1禁止/0允许分片），最低位(MF:More Fragment)（1还有分片/0代表最后一片）
- 片偏移：某片在原分组中的相对位置，以8B为单位

## IPv4

IP地址：连接到因特网的每台主机（或路由器）都分配一个32比特的全球唯一标识符

### 网络地址转换NAT

路由器对目的地址是私有IP地址的数据报一律不进行转发

NAT指通过将专用网络地址转换为公用地址

在专用网连接到因特网的路由器上安装NAT软件，称为NAT路由器，至少有一个有效的外部全球IP地址

NAT转换表：本地地址与全球地址互相转换

### 子网掩码与子网划分

规定：所有的网络必须使用子网掩码

- 两级IP地址：网络号+主机号（利用率低，不够灵活）
- 三级IP地址：网络号+子网号+主机号（对外表现为一个网络）
  - C类地址子网掩码：255.255.255.0，（11111111 11111111 11111111 00000000）与IP地址逐位相与，得到子网网络地址

### ARP协议

**地址解析协议**

无论网络层使用什么协议，在实际网络的链路上传送数据帧时，最终必须使用硬件地址

完成IP地址到MAC地址的映射

每台主机都设有一个ARP高速缓存，用来存放本局域网各主机和路由器的IP地址到MAC地址的映射表，ARP表，动态维护

执行过程：

1. 检查ARP高速缓存，有对应表项则写入MAC帧
2. 没有则广播ARP请求分组，同一局域网中所有主机都能收到该请求
3. 目的主机收到后向源主机单播一个ARP响应分组，源主机收到后将此映射写入ARP缓存

### DHCP

**动态主机配置协议**

给主机动态分配IP地址

DHCP是应用层协议，使用C/S方式，通过广播方式进行交互，基于UDP

主机可以从服务器动态获取IP地址、子网掩码、默认网关、DNS服务器名称，允许地址重用

### ICMP

让主机或路由器报告差错和异常情况

## IPv6

## 移动IP

## 网络层设备